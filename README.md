# FLAG STUDIO MAP
**Реализация тестового задания от компании Flag Studio.**

## Интро

#### Список выполненных задач
1. Реализована возможность добавления маркеров объектов на карте и боковой панели при клике на страну,
2. Возможность переключения между странами,
3. При выборе страны отображаются только ее объекты, а масштаб меняется,
4. При клике по объекту на карте или на боковой панели отображается балон с подробной информацией, карта центрируется на нем,
5. Спойлеры на боковой панели раскрываются и отображаются объекты с информацией,
6. При изменении масштаба маркеры на карте группируются.

## Технологии

При разработке я использовал `Vue.js`, `Vuex`. Собирал `webpack`\`ом. В качестве исходных данных использовал JSON файл `example.json`.


## Директории

В корне документа лежат довольно привычные файлы. `.editorconfig` использовал для удобства разработки.

`/src` - здесь находится весь исходный код

`/src/assets` - статичные файлы (шрифты, иконки...)

`/src/components` - однофайловые компоненты vue

`/src/css` - css файлы, которые я использловал для работы со шрифтами и переменными css

`/src/store` - директория для управления состоянием приложения (vuex). action-types.js содержит экспорты ключей для экшенов состояния, mutation-types.js для мутаций. В store.js лежит объект самого состояния, использующийся затем во vue.

## Установка

Для установки приложения (понадобится node и npm) склонируйте его к себе, затем в терминале введите команды:
1. `npm i`
2. `npm run build`

Затем в директории dist запустите файл index.html

Так же вы можете воспользоваться рабочим демо по ссылке
https://flag-map.glitch.me/

## Как все это работает?

Постараюсь вкратце изложить, как тут все устроено.

После того, как экземпляр Vue будет создан (App.vue), срабатывает метод, вызывающий экшн состояния GET_READY. Тот вызывает мутацию, ожидающую загрузку API Яндекс карт. После она ставит состояние приложения (apiReady) в true. Теперь можно создавать карту и объекты на ней.

Map.vue создает карту и ставит ее в свойство map состояния. Задает шаблон для балунов, чистит карту от лишних элементов управления. Затем устанавливает в свойство map состояния clusterer, который в будущем будет использоваться для создания кластеров.

При выборе пользователем страны вызывается метод setObjects. Тут начинается самое интересное. Во время реализации показа балунов и центрирования при клике на объект в боковой панели или на маркер я столкнулся с проблемой. Дело в том, что если объекты находятся в кластере, то они как бы "пропадают" с карты, и их балуны уже не открыть. Это происходит потому, что если объекта на карте нет, то его метод getMap() возвращает null, что и приводит к ошибке.

Для ее решения я создаю выборку объектов, помещаю их на карту, а затем сразу скрываю. Выборку добавляю в geoQueries в state. При повторном переключении на эту страну выборка не будет создаваться заново, если она уже хранится в geoQueries. Затем, используя кластеризатор в map, я добавялю туда метки, которые отображаются на карте. Переключая страны, я меняю только данные одного кластеризатора. Таким образом, даже если все объекты будут находиться в кластере, при клике на боковой панели пользователю отобразится балун над нужным кластером.

Более подробно узнать о методах вы сможете в компонентах, состоянии и App.vue.

## Аутро
Спасибо за интересное тз. Выполняя его, я получил удовольствие. Так же буду рад любым замечаниям и комментариям.
